---
########
# install oc
- name: Download oc client
  get_url: 
    url: "{{ oc_binary_url }}"
    dest: /tmp/oc.tar.gz
    mode: '0777'
  tags:
    - bastion
    - bastion.oc

- name: Extract oc client
  ansible.builtin.unarchive:
    src: /tmp/oc.tar.gz
    dest: /tmp/
    remote_src: yes
  tags:
    - bastion
    - bastion.oc

- name: Copy oc binary to /usr/local/bin
  copy:
    src: /tmp/oc
    dest: /usr/local/bin/oc
    mode: "0777"
    remote_src: yes
  tags:
    - bastion
    - bastion.oc

########
# CSR Autoapprove
- name: CSR Autoapprove
  environment:
    KUBECONFIG: /home/ansible/openshift/config/auth/kubeconfig
  ansible.builtin.command:
    cmd: "oc get csr | grep -i pending | cut -f 1 -d ' ' | xargs -n 1 oc adm certificate approve"
...
