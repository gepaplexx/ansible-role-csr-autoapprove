---
- name: Create async csr approvial job
  environment:
    KUBECONFIG: "{{ ocp_kubeconfig_file }}"
    NODES_COUNT: "{{ csr_autoapprove_node_count }}"
  ansible.builtin.script:
    cmd: /files/approve.sh

  async: 600
  poll: 0
  register: csr_autoapprove_pending_csrs
  changed_when: true

- name: Wait for pending csr requests
  ansible.builtin.async_status:
    jid: "{{ csr_autoapprove_pending_csrs.ansible_job_id }}"
  register: csr_autoapprove_pending_csrs_status
  until: csr_autoapprove_pending_csrs_status.finished
  delay: 30
  retries: 20
...
